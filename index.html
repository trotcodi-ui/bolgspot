<script>
const JSON_URL = "https://raw.githubusercontent.com/trotcodi-ui/2025lotto/main/2025lotto_numbers_1_to_1182_final.json";
let lottoData = [];
let dataLoaded = false;

fetch(JSON_URL)
  .then(res => res.json())
  .then(data => {
    lottoData = data;
    dataLoaded = true;
  });

function checkHistory() {
  if (!dataLoaded) {
    alert("데이터 로딩 중입니다. 잠시 후 다시 시도하세요.");
    return;
  }

  const input = document.getElementById("lottoInput").value;
  const resultDiv = document.getElementById("historyResult");
  resultDiv.innerHTML = "";

  const nums = input.split(",").map(n => parseInt(n.trim())).sort((a,b)=>a-b);
  if (nums.length !== 6) {
    resultDiv.textContent = "번호 6개를 정확히 입력하세요.";
    return;
  }

  let results = [];

  lottoData.forEach(d => {
    const winNums = d.numbers.slice().sort((a,b)=>a-b);
    const match = nums.filter(n => winNums.includes(n)).length;

    if (match === 6) results.push(`${d.draw_no}회차 : 1등 (6개 일치)`);
    else if (match === 5) results.push(`${d.draw_no}회차 : 3등 (5개 일치)`);
    else if (match === 4) results.push(`${d.draw_no}회차 : 4등 (4개 일치)`);
    else if (match === 3) results.push(`${d.draw_no}회차 : 5등 (3개 일치)`);
  });

  if (results.length === 0) {
    resultDiv.textContent = "과거 1·3·4·5등 당첨 이력이 없습니다.";
  } else {
    resultDiv.innerHTML = results.slice(0, 5).join("<br>");
  }
}

function analyzeStats() {
  if (!dataLoaded) {
    alert("데이터 로딩 중입니다. 잠시 후 다시 시도하세요.");
    return;
  }

  const count = parseInt(document.getElementById("roundSelect").value);
  const recent = lottoData.slice(-count);

  const freq = {};
  for (let i = 1; i <= 45; i++) freq[i] = 0;

  recent.forEach(d => d.numbers.forEach(n => freq[n]++));

  const sorted = Object.entries(freq)
    .map(([n, c]) => [parseInt(n), c])
    .sort((a, b) => b[1] - a[1]);

  showBalls("mostNumbers", sorted.slice(0, 6).map(v => v[0]));
  showBalls("leastNumbers", sorted.slice(-6).map(v => v[0]));

  generateRecommend(sorted.slice(0, 20));
}

function showBalls(id, numbers) {
  const el = document.getElementById(id);
  el.innerHTML = "";
  numbers.forEach(n => {
    const span = document.createElement("span");
    span.className = "ball";
    span.textContent = n;
    el.appendChild(span);
  });
}

function generateRecommend(pool) {
  const container = document.getElementById("recommendNumbers");
  container.innerHTML = "";

  for (let i = 0; i < 5; i++) {
    const pick = [];
    while (pick.length < 6) {
      const n = pool[Math.floor(Math.random() * pool.length)][0];
      if (!pick.includes(n)) pick.push(n);
    }
    pick.sort((a, b) => a - b);

    const line = document.createElement("div");
    line.className = "number-line";

    pick.forEach(n => {
      const span = document.createElement("span");
      span.className = "ball";
      span.textContent = n;
      line.appendChild(span);
    });

    container.appendChild(line);
  }
}
</script>
